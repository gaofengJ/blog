---
title: 29. 怎么给Canvas绘制加速
description: 可视化
---

影响 Canvas 性能的两大因素分别是图形的数量和图形的大小。它们都会直接影响绘图指令，一个决定了绘图指令的多少，另一个决定了绘图指令的执行时间。通常来说，绘图指令越多、执行时间越长，渲染效率就越低，性能也就越差。

因此，想要对 Canvas 性能进行优化，最重要的就是优化渲染效率。常用的手段有 5 种，分别是**优化 Canvas 指令**、**使用缓存**、**分层渲染**、**局部重绘**和**优化滤镜**。此外，还有一种手段叫做多线程渲染，是用来优化非渲染的计算和交互方面导致的性能问题。

## 优化 Canvas 指令

优化指令中性能比较低的地方，或者以其他指令替代

## 使用缓存

因为 Canvas 的性能瓶颈主要在绘图指令方面，如果我们能将图形缓存下来，保存到离屏的 Canvas（offscreen Canvas）中，然后在绘制的时候作为图像来渲染，那我们就可以将绘制顶点的绘图指令变成直接通过 drawImage 指令来绘制图像，而且也不需要 fill() 方法来填充图形，这样性能就会有大幅度的提升。

## 分层渲染

可以用两个 Canvas 叠在一起，将不变的元素绘制在一个 Canvas 中，变化的元素绘制在另一个 Canvas 中。

## 局部手绘

不需要清空 Canvas 的全局区域，而是根据运动的元素的范围来清空部分区域。

可以用 Canvas 上下文的 clearRect 方法控制要刷新的动态区域，只对这些区域进行擦除然后重绘。

## 优化滤镜

## 多线程渲染

浏览器支持的 Canvas 可以在 WebWorker 中以单独的线程来渲染。

在浏览器主线程中创建 Worker，然后将 Canvas 对象通过 transferControlToOffscreen 转成离屏 Canvas 对象发送给 Worker 线程去处理。
