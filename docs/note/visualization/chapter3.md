---
title: 03. 声明式图形系统：如何用SVG图形元素绘制可视化图表?
description: 可视化
---

SVG 的全称是 Scalable Vector Graphics，可缩放矢量图，它是浏览器支持的一种基于 XML 语法的图像格式。

## 利用 SVG 绘制几何图形

```html
<svg xmlns="http://www.w3.org/2000/svg" version="1.1">
  <circle cx="100" cy="50" r="40" stroke="black" stroke-width="2" fill="orange" />
</svg>
```

svg 元素是 SVG 的根元素，属性 xmlns 是 xml 的命名空间，浏览器根据这个属性值就可以识别出这是一段 SVG 的内容。

SVG 坐标系和 Canvas 坐标系完全一样，都是以图像左上角为原点，x 轴向右，y 轴向下的左手坐标系。

在默认情况下，SVG 坐标与浏览器像素对应。

也可以通过给 svg 元素设置 viewBox 属性，来改变 SVG 的坐标系。如果设置了 viewBox 属性，那 SVG 内部的绘制就都是相对于 SVG 坐标系的了。

## SVG 和 Canvas 的不同点

* 写法上的不同

SVG 是以创建图形元素绘图的“声明式”绘图系统，Canvas 是执行绘图指令绘图的“指令式”绘图系统。

因为 SVG 的声明式类似于 HTML 书写方式，本身对前端工程师会更加友好。但是，SVG 图形需要由浏览器负责渲染和管理，将元素节点维护在 DOM 树中。这样做的缺点是，在一些动态的场景中，也就是需要频繁地增加、删除图形元素的场景中，SVG 与一般的 HTML 元素一样会带来 DOM 操作的开销，所以 SVG 的渲染性能相对比较低。

* 用户交互实现上的不同

SVG 的一个图形对应一个元素，所以我们可以像处理 DOM 元素一样，很容易地给 SVG 图形元素添加对应的鼠标事件。

## 绘制大量几何图形时 SVG 的性能问题

在一般情况下，当 SVG 节点超过一千个的时候，就能很明显感觉到性能问题了。

## SVG 常用 API

[SVG API](https://developer.mozilla.org/zh-CN/docs/Web/SVG/Tutorial)

### path

path 元素的形状是通过属性d定义的，属性d的值是一个“命令 + 参数”的序列。

因为属性 d采用的是用户坐标系统，所以不需标明单位。

每一个命令都有两种表示方式，一种是用大写字母，表示采用绝对定位。另一种是用小写字母，表示采用相对定位（例如：从上一个点开始，向上移动 10px，向左移动 7px）。

#### 直线命令

`<path>`元素里有 5 个画直线的命令，顾名思义，直线命令就是在两个点之间画直线。

* Move to

M，需要两个参数，分别是需要移动到的点的 x 轴和 y 轴的坐标。

M 命令仅仅是移动画笔，但不画线。

```html
M x y
or
m dx dy
```

* Line to

L 需要两个参数，分别是一个点的 x 轴和 y 轴坐标，L 命令将会在当前位置和新位置（L 前面画笔所在的点）之间画一条线段。

```html
L x y
or
l dx dy
```

* H

绘制水平线

```html
H x
or
h dx
```

* V

绘制垂直线

```html
V y
or
v dy
```

* Z

Z 命令会从当前点画一条直线到路径的起点，尽管我们不总是需要闭合路径，但是它还是经常被放到路径的最后。

```html
Z
or
z
```

#### 曲线命令

绘制平滑曲线的命令有三个，其中两个用来绘制贝塞尔曲线，另外一个用来绘制弧形or者说是圆的一部分。

[贝塞尔曲线原理](https://juejin.cn/post/7082701281969569829)

贝塞尔曲线的类型有很多，但是在 path 元素里，只存在两种贝塞尔曲线：三次贝塞尔曲线 C，和二次贝塞尔曲线 Q。

* C

三次贝塞尔曲线需要定义一个点和两个控制点，最后一个坐标 (x,y) 表示的是曲线的终点，另外两个坐标是控制点，(x1,y1) 是起点的控制点，(x2,y2) 是终点的控制点。

```html
C x1 y1, x2 y2, x y
or
c dx1 dy1, dx2 dy2, dx dy
```

* Q

二次贝塞尔曲线，需要一个控制点，用来确定起点和终点的曲线斜率。它需要两组参数，控制点和终点坐标。

```html
Q x1 y1, x y
(or)
q dx1 dy1, dx dy
```

* A

弧形命令 A 是另一个创建 SVG 曲线的命令。
